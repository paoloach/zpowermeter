###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.30.1.41636 for 8051             30/Oct/2015  18:26:23 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\Source\ha\zcl_ha.cpp                            #
#    Command line       =  -f C:\Users\paolo\Documents\GitHub\zpowermeter\fir #
#                          mware\CC2530DB\..\Tools\f8wRouter.cfg (-DCPU32MHZ  #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Tools\f8wConfig.cfg (-DZIGBEEPRO    #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=5000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f                         #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Tools\f8wZCL.cfg                    #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\Source\ha\zcl_ha.cpp -D SECURE=0 -D             #
#                          OSC32K_CRYSTAL_INSTALLED=FALSE -D HAL_KEY=FALSE    #
#                          -D HAL_BOARD_CC2530EB_REV17 -D TC_LINKKEY_JOIN -D  #
#                          NV_INIT -D xNV_RESTORE -D MULTICAST_ENABLED=FALSE  #
#                          -D ZCL_READ -D ZCL_WRITE -D ZCL_REPORT -D          #
#                          FEATURE_SYSTEM_STATS -lC                           #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\List\ -lA                     #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\List\ --diag_suppress         #
#                          Pe001,Pa010 -o C:\Users\paolo\Documents\GitHub\zpo #
#                          wermeter\firmware\CC2530DB\RouterEB\Obj\ -e        #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I C:\Users\paolo\Documents\GitHub\zpowermeter\fir #
#                          mware\CC2530DB\ -I C:\Users\paolo\Documents\GitHub #
#                          \zpowermeter\firmware\CC2530DB\..\Source\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Source\ha\ -I                       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Source\zmain\ -I                    #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\hal\include\ -I          #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\hal\target\CC2530EB\ -I  #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\include\ -I          #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\high_level\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\low_level\srf04\ -I  #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\low_level\srf04\sing #
#                          le_chip\ -I C:\Users\paolo\Documents\GitHub\zpower #
#                          meter\firmware\CC2530DB\..\Components\mt\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\osal\include\ -I         #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\services\saddr\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\services\sdata\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\af\ -I             #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\nwk\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\sapi\ -I           #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\sec\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\sys\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\zcl\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\zdo\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\zmac\ -I                 #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\zmac\f8w\ -Ohz --eec++   #
#    List file          =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\List\zcl_ha.lst               #
#    Object file        =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\Obj\zcl_ha.r51                #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\paolo\Documents\GitHub\zpowermeter\firmware\Source\ha\zcl_ha.cpp
      1          /**************************************************************************************************
      2            Filename:       zcl_ha.c
      3            Revised:        $Date: 2013-10-21 12:15:10 -0700 (Mon, 21 Oct 2013) $
      4            Revision:       $Revision: 35738 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2013 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /*********************************************************************
     41           * INCLUDES
     42           */
     43          
     44          #include "ZComDef.h"
     45          #include "OSAL.h"
     46          
     47          #include "zcl.h"
     48          #include "zcl_general.h"
     49          #include "zcl_closures.h"
     50          //#include "zcl_HVAC.h"
     51          #include "zcl_ss.h"
     52          #include "zcl_ms.h"
     53          #include "zcl_lighting.h"
     54          #include "zcl_ha.h"
     55          
     56          /*********************************************************************
     57           * MACROS
     58           */
     59          
     60          /*********************************************************************
     61           * CONSTANTS
     62           */
     63          
     64          /*********************************************************************
     65           * TYPEDEFS
     66           */
     67          
     68          /*********************************************************************
     69           * GLOBAL VARIABLES
     70           */
     71          
     72          /*********************************************************************
     73           * EXTERNAL VARIABLES
     74           */
     75          
     76          /*********************************************************************
     77           * EXTERNAL FUNCTIONS
     78           */
     79          
     80          /*********************************************************************
     81           * LOCAL VARIABLES
     82           */
     83          
     84          /*********************************************************************
     85           * STATUS STRINGS
     86           */
     87          // NwkInfo displayed on line 1 once on the network
     88          // 0123456789012345
     89          // Zc: PPPP CH ADDR
     90          // Zr: PPPP CH ADDR
     91          // Zed:PPPP CH ADDR
     92          const char NwkInfoZcStr[]  = "ZC: ";
     93          const char NwkInfoZrStr[]  = "ZR: ";
     94          const char NwkInfoZedStr[] = "Zed:";
     95          const char * const NwkInfoStrs[] = { NwkInfoZcStr, NwkInfoZrStr, NwkInfoZedStr };
                                    ^
Warning[Pe177]: variable "NwkInfoStrs" was declared but never referenced
     96          
     97          /*********************************************************************
     98           * LOCAL FUNCTIONS
     99           */
    100          
    101          /*********************************************************************
    102           * @fn      zclHA_Init
    103           *
    104           * @brief   Register the Simple descriptor with the HA profile.
    105           *          This function also registers the profile's cluster conversion table.
    106           *
    107           * @param   simpleDesc - a pointer to a valid SimpleDescriptionFormat_t, must not be NULL.
    108           *
    109           * @return  none
    110           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    111          void zclHA_Init( SimpleDescriptionFormat_t *simpleDesc ){
   \                     zclHA_Init:
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    112            endPointDesc_t *epDesc;
    113          
    114            // Register the application's endpoint descriptor
    115            //  - This memory is allocated and never freed.
    116            epDesc = (endPointDesc_t *)osal_mem_alloc( sizeof ( endPointDesc_t ) );
   \   000009                ; Setup parameters for call to function osal_mem_alloc
   \   000009   7A06         MOV     R2,#0x6
   \   00000B   7B00         MOV     R3,#0x0
   \   00000D   12....       LCALL   ??osal_mem_alloc?relay; Banked call to: osal_mem_alloc
    117            if ( epDesc ) {
   \   000010   EA           MOV     A,R2
   \   000011   4B           ORL     A,R3
   \   000012   6022         JZ      ??zclHA_Init_0
    118              // Fill out the endpoint description.
    119              epDesc->endPoint = simpleDesc->EndPoint;
   \   000014   8E82         MOV     DPL,R6
   \   000016   8F83         MOV     DPH,R7
   \   000018   E0           MOVX    A,@DPTR
   \   000019   8A82         MOV     DPL,R2
   \   00001B   8B83         MOV     DPH,R3
   \   00001D   F0           MOVX    @DPTR,A
    120              epDesc->task_id = &zcl_TaskID;   // all messages get sent to ZCL first
   \   00001E   A3           INC     DPTR
   \   00001F   74..         MOV     A,#zcl_TaskID & 0xff
   \   000021   F0           MOVX    @DPTR,A
   \   000022   A3           INC     DPTR
   \   000023   74..         MOV     A,#(zcl_TaskID >> 8) & 0xff
   \   000025   12....       LCALL   ?Subroutine3 & 0xFFFF
    121              epDesc->simpleDesc = simpleDesc;
   \                     ??CrossCallReturnLabel_3:
   \   000028   EE           MOV     A,R6
   \   000029   F0           MOVX    @DPTR,A
   \   00002A   A3           INC     DPTR
   \   00002B   EF           MOV     A,R7
   \   00002C   12....       LCALL   ?Subroutine3 & 0xFFFF
    122              epDesc->latencyReq = noLatencyReqs;
   \                     ??CrossCallReturnLabel_4:
   \   00002F   A3           INC     DPTR
   \   000030   A3           INC     DPTR
   \   000031   E4           CLR     A
   \   000032   F0           MOVX    @DPTR,A
    123          
    124              // Register the endpoint description with the AF
    125              afRegister( epDesc );
   \   000033                ; Setup parameters for call to function afRegister
   \   000033   12....       LCALL   ??afRegister?relay   ; Banked call to: afRegister
    126            }
    127          }
   \                     ??zclHA_Init_0:
   \   000036   7F02         MOV     R7,#0x2
   \   000038   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   A3           INC     DPTR
   \   000006   A3           INC     DPTR
   \   000007   A3           INC     DPTR
   \   000008   22           RET
    128          
    129          /*********************************************************************
    130           * @fn      zclHA_isbit
    131           *
    132           * @brief   Returns TRUE if the index bit is set
    133           *
    134           * @param   pArray   - array with bits in it
    135           *          bitIndex - index into the array of bits
    136           *
    137           * @return  TRUE if index bit is set
    138           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    139          bool zclHA_isbit(uint8 *pArray, uint8 bitIndex)
   \                     zclHA_isbit:
    140          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    141            uint8 bit;
    142            bit = ( 1 << ( bitIndex & 0x7 ) );
    143            if( pArray[bitIndex >> 3] & bit )
   \   000004   12....       LCALL   ??Subroutine5_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000007   C0E0         PUSH    A
   \   000009   7407         MOV     A,#0x7
   \   00000B   59           ANL     A,R1
   \   00000C   F8           MOV     R0,A
   \   00000D   D0E0         POP     A
   \   00000F   B80002       CJNE    R0,#0x0,??zclHA_isbit_0
   \   000012   8004         SJMP    ??zclHA_isbit_1
   \                     ??zclHA_isbit_0:
   \   000014   C3           CLR     C
   \   000015   13           RRC     A
   \   000016   D8FC         DJNZ    R0,??zclHA_isbit_0
   \                     ??zclHA_isbit_1:
   \   000018   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001A   5003         JNC     ??zclHA_isbit_2
    144              return TRUE;
   \   00001C   D3           SETB    C
   \   00001D   8001         SJMP    ??zclHA_isbit_3
    145            return FALSE;
   \                     ??zclHA_isbit_2:
   \   00001F   C3           CLR     C
   \                     ??zclHA_isbit_3:
   \   000020   80..         SJMP    ??Subroutine4_0
    146          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine4_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine5_0:
   \   000000   E9           MOV     A,R1
   \   000001   13           RRC     A
   \   000002   13           RRC     A
   \   000003   13           RRC     A
   \   000004   541F         ANL     A,#0x1f
   \   000006   FC           MOV     R4,A
   \   000007   EA           MOV     A,R2
   \   000008   2C           ADD     A,R4
   \   000009   F582         MOV     DPL,A
   \   00000B   E4           CLR     A
   \   00000C   3B           ADDC    A,R3
   \   00000D   F583         MOV     DPH,A
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   22           RET
    147          
    148          /*********************************************************************
    149           * @fn      zclHA_setbit
    150           *
    151           * @brief   Sets a bit in a bit array
    152           *
    153           * @param   pArray   - array with bits in it
    154           *          bitIndex - index into the array of bits
    155           *
    156           * @return  none
    157           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    158          void zclHA_setbit(uint8 *pArray, uint8 bitIndex)
   \                     zclHA_setbit:
    159          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    160            uint8 bit;
    161            bit = ( 1 << ( bitIndex & 0x7 ) );
    162            pArray[bitIndex >> 3] |= bit;
   \   000004   7407         MOV     A,#0x7
   \   000006   59           ANL     A,R1
   \   000007   F8           MOV     R0,A
   \   000008   7401         MOV     A,#0x1
   \   00000A   B80002       CJNE    R0,#0x0,??zclHA_setbit_0
   \   00000D   8004         SJMP    ??zclHA_setbit_1
   \                     ??zclHA_setbit_0:
   \   00000F   C3           CLR     C
   \   000010   33           RLC     A
   \   000011   D8FC         DJNZ    R0,??zclHA_setbit_0
   \                     ??zclHA_setbit_1:
   \   000013   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000016   48           ORL     A,R0
   \   000017                REQUIRE ?Subroutine0
   \   000017                ; // Fall through to label ?Subroutine0
    163          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                REQUIRE ??Subroutine4_0
   \   000001                ; // Fall through to label ??Subroutine4_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F8           MOV     R0,A
   \   000001                REQUIRE ??Subroutine5_0
   \   000001                ; // Fall through to label ??Subroutine5_0
    164          
    165          /*********************************************************************
    166           * @fn      zclHA_clearbit
    167           *
    168           * @brief   clears a bit in a bit array
    169           *
    170           * @param   pArray   - array with bits in it
    171           *          bitIndex - index into the array of bits
    172           *
    173           * @return  none
    174           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    175          void zclHA_clearbit(uint8 *pArray, uint8 bitIndex)
   \                     zclHA_clearbit:
    176          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    177            uint8 bit;
    178            bit = ( 1 << ( bitIndex & 0x7 ) );
    179            pArray[bitIndex >> 3] &= (~(unsigned)bit);
   \   000004   7407         MOV     A,#0x7
   \   000006   59           ANL     A,R1
   \   000007   F8           MOV     R0,A
   \   000008   7401         MOV     A,#0x1
   \   00000A   B80002       CJNE    R0,#0x0,??zclHA_clearbit_0
   \   00000D   8004         SJMP    ??zclHA_clearbit_1
   \                     ??zclHA_clearbit_0:
   \   00000F   C3           CLR     C
   \   000010   33           RLC     A
   \   000011   D8FC         DJNZ    R0,??zclHA_clearbit_0
   \                     ??zclHA_clearbit_1:
   \   000013   F4           CPL     A
   \   000014   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000017   58           ANL     A,R0
   \   000018   80..         SJMP    ?Subroutine0
    180          }
    181          
    182          /*********************************************************************
    183           * @fn      zclHA_uint16toa
    184           *
    185           * @brief   Converts from a uint16 to ascii hex string.
    186           *          The # will be exactly 4 hex digits (e.g. 0x0000 or 0x1E3F).
    187           *          NULL terminates the string.
    188           *
    189           * @param   u - Number to be converted
    190           *          string - pointer to coverted string
    191           *
    192           * @return  none
    193           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    194          void zclHA_uint16toa(uint16 u, char *string)
   \                     zclHA_uint16toa:
    195          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    196            // add preceding zeros
    197            if ( u < 0x1000 )
   \   000005   C3           CLR     C
   \   000006   EB           MOV     A,R3
   \   000007   9410         SUBB    A,#0x10
   \   000009   5003         JNC     ??CrossCallReturnLabel_0
    198            {
    199              *string++ = '0';
   \   00000B   12....       LCALL   ?Subroutine2 & 0xFFFF
    200            }
    201          
    202            if ( u < 0x0100 )
   \                     ??CrossCallReturnLabel_0:
   \   00000E   C3           CLR     C
   \   00000F   EB           MOV     A,R3
   \   000010   9401         SUBB    A,#0x1
   \   000012   5003         JNC     ??CrossCallReturnLabel_1
    203            {
    204              *string++ = '0';
   \   000014   12....       LCALL   ?Subroutine2 & 0xFFFF
    205            }
    206          
    207            if ( u < 0x0010 )
   \                     ??CrossCallReturnLabel_1:
   \   000017   C3           CLR     C
   \   000018   EA           MOV     A,R2
   \   000019   9410         SUBB    A,#0x10
   \   00001B   EB           MOV     A,R3
   \   00001C   9400         SUBB    A,#0x0
   \   00001E   5003         JNC     ??CrossCallReturnLabel_2
    208            {
    209              *string++ = '0';
   \   000020   12....       LCALL   ?Subroutine2 & 0xFFFF
    210            }
    211          
    212            _ltoa((unsigned long)u, (unsigned char *)string, 16);
   \                     ??CrossCallReturnLabel_2:
   \   000023                ; Setup parameters for call to function _ltoa
   \   000023   8C..         MOV     ?V0,R4
   \   000025   8D..         MOV     ?V1,R5
   \   000027   78..         MOV     R0,#?V0
   \   000029   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002C   7910         MOV     R1,#0x10
   \   00002E   E4           CLR     A
   \   00002F   FC           MOV     R4,A
   \   000030   FD           MOV     R5,A
   \   000031   12....       LCALL   ??_ltoa?relay        ; Banked call to: _ltoa
   \   000034   7402         MOV     A,#0x2
   \   000036   12....       LCALL   ?DEALLOC_XSTACK8
    213          }
   \   000039   7F04         MOV     R7,#0x4
   \   00003B   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   8C82         MOV     DPL,R4
   \   000002   8D83         MOV     DPH,R5
   \   000004   7430         MOV     A,#0x30
   \   000006   F0           MOVX    @DPTR,A
   \   000007   A3           INC     DPTR
   \   000008   AC82         MOV     R4,DPL
   \   00000A   AD83         MOV     R5,DPH
   \   00000C   22           RET
    214          
    215          /*********************************************************************
    216           * @fn      zclHA_uint8toa
    217           *
    218           * @brief   Converts from a uint8 to ascii decimal string.
    219           *          The # will be exactly 3 digits (e.g. "123", " 64", "  0"), preceded by spaces.
    220           *          No null terminator.
    221           *
    222           * @param   b - Byte to be converted
    223           *          string - pointer to coverted string
    224           *
    225           * @return  none
    226           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    227          void zclHA_uint8toa(uint8 b, char *string)
   \                     zclHA_uint8toa:
    228          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    229            // write the level (up to 3 digits, pre-padded with spaces)
    230            string[0] = string[1] = string[2] = '0';
   \   000007   EA           MOV     A,R2
   \   000008   2402         ADD     A,#0x2
   \   00000A   F8           MOV     R0,A
   \   00000B   E4           CLR     A
   \   00000C   3B           ADDC    A,R3
   \   00000D   F9           MOV     R1,A
   \   00000E   E8           MOV     A,R0
   \   00000F   FC           MOV     R4,A
   \   000010   E9           MOV     A,R1
   \   000011   FD           MOV     R5,A
   \   000012   8C82         MOV     DPL,R4
   \   000014   8D83         MOV     DPH,R5
   \   000016   7430         MOV     A,#0x30
   \   000018   F0           MOVX    @DPTR,A
   \   000019   8A82         MOV     DPL,R2
   \   00001B   8B83         MOV     DPH,R3
   \   00001D   A3           INC     DPTR
   \   00001E   A882         MOV     R0,DPL
   \   000020   A983         MOV     R1,DPH
   \   000022   F0           MOVX    @DPTR,A
   \   000023   8A82         MOV     DPL,R2
   \   000025   8B83         MOV     DPH,R3
   \   000027   F0           MOVX    @DPTR,A
    231            string[2] = '0' + (b % 10);  // 1s
   \   000028   EE           MOV     A,R6
   \   000029   75F00A       MOV     B,#0xa
   \   00002C   84           DIV     AB
   \   00002D   E5F0         MOV     A,B
   \   00002F   2430         ADD     A,#0x30
   \   000031   8C82         MOV     DPL,R4
   \   000033   8D83         MOV     DPH,R5
   \   000035   F0           MOVX    @DPTR,A
    232            b = b / 10;
   \   000036   75F00A       MOV     B,#0xa
   \   000039   EE           MOV     A,R6
   \   00003A   84           DIV     AB
   \   00003B   FE           MOV     R6,A
    233            if( b )
   \   00003C   6021         JZ      ??zclHA_uint8toa_0
    234            {
    235              string[1] = '0' + (b % 10);  // 10s
   \   00003E   75F00A       MOV     B,#0xa
   \   000041   84           DIV     AB
   \   000042   E5F0         MOV     A,B
   \   000044   2430         ADD     A,#0x30
   \   000046   8882         MOV     DPL,R0
   \   000048   8983         MOV     DPH,R1
   \   00004A   F0           MOVX    @DPTR,A
    236              b = b / 10;
   \   00004B   75F00A       MOV     B,#0xa
   \   00004E   EE           MOV     A,R6
   \   00004F   84           DIV     AB
    237            }
    238            if( b )
   \   000050   600D         JZ      ??zclHA_uint8toa_0
    239            {
    240             string[0] = '0' + (b % 10);  // 100s
   \   000052   75F00A       MOV     B,#0xa
   \   000055   84           DIV     AB
   \   000056   E5F0         MOV     A,B
   \   000058   2430         ADD     A,#0x30
   \   00005A   8A82         MOV     DPL,R2
   \   00005C   8B83         MOV     DPH,R3
   \   00005E   F0           MOVX    @DPTR,A
    241            }
    242          }
   \                     ??zclHA_uint8toa_0:
   \   00005F   7F01         MOV     R7,#0x1
   \   000061   02....       LJMP    ?BANKED_LEAVE_XDATA
    243          
    244          /*********************************************************************
    245           * @fn      zclHA_LcdStatusLine1
    246           *
    247           * @brief   Display LCD line 1 with network status
    248           *          only call after on network
    249           *          ZC: PPPP CH ADDR
    250           *          ZR: PPPP CH ADDR
    251           *          ZE: PPPP CH ADDR
    252           *
    253           * @param   kind (0=ZC, 1=ZR, 2=ZED)
    254           *
    255           * @return  none
    256           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    257          void zclHA_LcdStatusLine1( uint8 kind )
   \                     zclHA_LcdStatusLine1:
    258          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    259          #if defined ( LCD_SUPPORTED )
    260            char szLine[20];
    261          
    262            // copy in what node type it is
    263            if ( kind > ZCL_HA_DEVICE_END_DEVICE )
    264            {
    265              return;
    266            }
    267          
    268            // ZE: PANx CH ADDR
    269            osal_memcpy( szLine, NwkInfoStrs[kind], 4 );
    270            zclHA_uint16toa( _NIB.nwkPanId, &szLine[4] );
    271            szLine[8] = ' ';
    272          
    273            _ltoa( _NIB.nwkLogicalChannel, (void *)(&szLine[9]), 10 );
    274            szLine[11] = ' ';
    275          
    276            zclHA_uint16toa( _NIB.nwkDevAddress, &szLine[12] );
    277            HalLcdWriteString( (char*)szLine, HAL_LCD_LINE_1 );
    278          #endif
    279          }
   \   000000   02....       LJMP    ?BRET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_isbit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_isbit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_setbit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_setbit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_clearbit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_clearbit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_uint16toa?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_uint16toa

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_uint8toa?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_uint8toa

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??zclHA_LcdStatusLine1?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    zclHA_LcdStatusLine1
    280          
    281          /*********************************************************************
    282          *********************************************************************/

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      1     10   zclHA_Init
        0     10   -> afRegister
        0     10   -> osal_mem_alloc
      0      0   zclHA_LcdStatusLine1
      3      0   zclHA_clearbit
      3      0   zclHA_isbit
      3      0   zclHA_setbit
      0     14   zclHA_uint16toa
        0     14   -> _ltoa
      1      9   zclHA_uint8toa


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       7  ??Subroutine4_0
      17  ??Subroutine5_0
       6  ??zclHA_Init?relay
       6  ??zclHA_LcdStatusLine1?relay
       6  ??zclHA_clearbit?relay
       6  ??zclHA_isbit?relay
       6  ??zclHA_setbit?relay
       6  ??zclHA_uint16toa?relay
       6  ??zclHA_uint8toa?relay
       1  ?Subroutine0
       1  ?Subroutine1
      13  ?Subroutine2
       9  ?Subroutine3
      59  zclHA_Init
       3  zclHA_LcdStatusLine1
      26  zclHA_clearbit
      34  zclHA_isbit
      23  zclHA_setbit
      62  zclHA_uint16toa
     100  zclHA_uint8toa

 
 355 bytes in segment BANKED_CODE
  42 bytes in segment BANK_RELAYS
 
 397 bytes of CODE memory

Errors: none
Warnings: 1
