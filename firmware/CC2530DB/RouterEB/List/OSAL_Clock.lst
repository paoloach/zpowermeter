###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.30.1.41636 for 8051             14/Oct/2015  08:15:19 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\Components\osal\common\OSAL_Clock.c             #
#    Command line       =  -f C:\Users\paolo\Documents\GitHub\zpowermeter\fir #
#                          mware\CC2530DB\..\Tools\f8wRouter.cfg (-DCPU32MHZ  #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f                   #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Tools\f8wConfig.cfg (-DZIGBEEPRO    #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=5000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f                         #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Tools\f8wZCL.cfg                    #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\Components\osal\common\OSAL_Clock.c -D          #
#                          SECURE=0 -D OSC32K_CRYSTAL_INSTALLED=FALSE -D      #
#                          HAL_KEY=FALSE -D HAL_BOARD_CC2530EB_REV17 -D       #
#                          TC_LINKKEY_JOIN -D NV_INIT -D xNV_RESTORE -D       #
#                          MULTICAST_ENABLED=FALSE -D ZCL_READ -D ZCL_WRITE   #
#                          -D ZCL_REPORT -D FEATURE_SYSTEM_STATS -lC          #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\List\ -lA                     #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\List\ --diag_suppress         #
#                          Pe001,Pa010 -o C:\Users\paolo\Documents\GitHub\zpo #
#                          wermeter\firmware\CC2530DB\RouterEB\Obj\ -e        #
#                          --debug --core=plain --dptr=16,1                   #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I C:\Users\paolo\Documents\GitHub\zpowermeter\fir #
#                          mware\CC2530DB\ -I C:\Users\paolo\Documents\GitHub #
#                          \zpowermeter\firmware\CC2530DB\..\Source\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Source\ha\ -I                       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Source\zmain\ -I                    #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\hal\include\ -I          #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\hal\target\CC2530EB\ -I  #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\include\ -I          #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\high_level\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\low_level\srf04\ -I  #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\mac\low_level\srf04\sing #
#                          le_chip\ -I C:\Users\paolo\Documents\GitHub\zpower #
#                          meter\firmware\CC2530DB\..\Components\mt\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\osal\include\ -I         #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\services\saddr\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\services\sdata\ -I       #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\af\ -I             #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\nwk\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\sapi\ -I           #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\sec\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\sys\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\zcl\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\stack\zdo\ -I            #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\zmac\ -I                 #
#                          C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\..\Components\zmac\f8w\ -Ohz           #
#                          --require_prototypes                               #
#    List file          =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\List\OSAL_Clock.lst           #
#    Object file        =  C:\Users\paolo\Documents\GitHub\zpowermeter\firmwa #
#                          re\CC2530DB\RouterEB\Obj\OSAL_Clock.r51            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\paolo\Documents\GitHub\zpowermeter\firmware\Components\osal\common\OSAL_Clock.c
      1          /******************************************************************************
      2            Filename:       OSAL_Clock.c
      3            Revised:        $Date: 2012-02-26 13:15:18 -0800 (Sun, 26 Feb 2012) $
      4            Revision:       $Revision: 29523 $
      5          
      6            Description:    OSAL Clock definition and manipulation functions.
      7          
      8            Copyright 2008-2012 Texas Instruments Incorporated. All rights reserved.
      9          
     10            IMPORTANT: Your use of this Software is limited to those specific rights
     11            granted under the terms of a software license agreement between the user
     12            who downloaded the software, his/her employer (which must be your employer)
     13            and Texas Instruments Incorporated (the "License"). You may not use this
     14            Software unless you agree to abide by the terms of the License. The License
     15            limits your use, and you acknowledge, that the Software may not be modified,
     16            copied or distributed unless embedded on a Texas Instruments microcontroller
     17            or used solely and exclusively in conjunction with a Texas Instruments radio
     18            frequency transceiver, which is integrated into your product. Other than for
     19            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     20            works of, modify, distribute, perform, display or sell this Software and/or
     21            its documentation for any purpose.
     22          
     23            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     24            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     25            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     26            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     27            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     28            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     29            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     30            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     31            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     32            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     33            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     34          
     35            Should you have any questions regarding your right to use this Software,
     36            contact Texas Instruments Incorporated at www.TI.com.
     37          ******************************************************************************/
     38          
     39          /*********************************************************************
     40           * INCLUDES
     41           */
     42          
     43          #include "comdef.h"
     44          #include "hal_board.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1
     45          #include "OnBoard.h"
     46          #include "OSAL.h"
     47          #include "OSAL_Clock.h"
     48          
     49          /*********************************************************************
     50           * MACROS
     51           */
     52          
     53          #define	YearLength(yr)	((uint16)(IsLeapYear(yr) ? 366 : 365))
     54          
     55          /*********************************************************************
     56           * CONSTANTS
     57           */
     58          
     59          #define	BEGYEAR  2000     //  UTC started at 00:00:00 January 1, 2000
     60          
     61          #define	DAY      86400UL  // 24 hours * 60 minutes * 60 seconds
     62          
     63          /* Check Below for an explanation */
     64          #define COUNTER_TICK320US 204775UL 
     65          
     66          /* converted COUNTER_TICK320US from 320us ticks to ms */
     67          #define COUNTER_ELAPSEDMS 65528UL   
     68          
     69          /* 
     70           * Each tick is 320us so a value greater than 3 implies 
     71           * that atleast one millisecond has elapsed 320us*4 > 1 ms 
     72           */
     73          #define TIMER_CLOCK_UPDATE 4 
     74                                            
     75          /*********************************************************************
     76           * TYPEDEFS
     77           */
     78          
     79          /*********************************************************************
     80           * GLOBAL VARIABLES
     81           */
     82          
     83          /*********************************************************************
     84           * EXTERNAL VARIABLES
     85           */
     86          
     87          /*********************************************************************
     88           * EXTERNAL FUNCTIONS
     89           */
     90          extern uint32 macMcuPrecisionCount(void);
     91          
     92          #if (defined HAL_MCU_CC2430) || (defined HAL_MCU_CC2530) || (defined HAL_MCU_CC2533)
     93          
     94            /*  This function is used to divide a 31 bit dividend by a 16 bit
     95             *  divisor and return a packed 16 bit quotient and 16 bit
     96             *  remainder.
     97             *
     98             *  Note: This routine takes ~25.6us @32MHz. With C overhead, the
     99             *        time is ~32us.
    100             *
    101             *  dividend - 31 bit dividend.
    102             *  divisor - 16 bit divisor.
    103             *
    104             *  return - MSW divisor; LSW quotient
    105             */
    106            extern __near_func uint32 osalMcuDivide31By16To16( uint32 dividend, uint16 divisor );
    107          
    108            #define CONVERT_320US_TO_MS_ELAPSED_REMAINDER( x, y, z ) st( \
    109                                                                         \
    110              /* The 16 bit quotient is in MSW and */                    \
    111              /* the 16 bit remainder is in LSW. */                      \
    112              x = osalMcuDivide31By16To16( x, 25 );                      \
    113                                                                         \
    114              /* Add quotient to y */                                    \
    115              y += (x >> 16);                                            \
    116                                                                         \
    117              /* Copy remainder to z */                                  \
    118              z = (uint16)(x & 0x0FFFF);                                 \
    119            )
    120            
    121            #define CONVERT_MS_TO_S_ELAPSED_REMAINDER( x, y, z ) st(     \
    122                                                                         \
    123              /* The 16 bit quotient is in MSW and */                    \
    124              /* the 16 bit remainder is in LSW. */                      \
    125              x = osalMcuDivide31By16To16( x, 1000 );                    \
    126                                                                         \
    127              /* Add quotient to y */                                    \
    128              y += (x >> 16);                                            \
    129                                                                         \
    130              /* Copy remainder to z */                                  \
    131              z = (uint16)(x & 0x0FFFF);                                 \
    132            )
    133          
    134          #else /* (defined HAL_MCU_CC2430) || (defined HAL_MCU_CC2530) || (defined HAL_MCU_CC2533) */
    135          
    136            #define CONVERT_320US_TO_MS_ELAPSED_REMAINDER( x, y, z ) st( \
    137              y += x / 25;                                               \
    138              z = x % 25;                                                \
    139            )
    140            
    141            #define CONVERT_MS_TO_S_ELAPSED_REMAINDER( x, y, z ) st(     \
    142              y += x / 1000;                                             \
    143              z = x % 1000;                                              \
    144            )
    145          #endif /* (defined HAL_MCU_CC2430) || (defined HAL_MCU_CC2530) || (defined HAL_MCU_CC2533) */
    146          
    147          /*********************************************************************
    148           * LOCAL VARIABLES
    149           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    150          static uint32 previousMacTimerTick = 0;
   \                     previousMacTimerTick:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    151          static uint16 remUsTicks = 0;
   \                     remUsTicks:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    152          static uint32 timeMSec = 0;
   \                     timeMSec:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    153          
    154          // number of seconds since 0 hrs, 0 minutes, 0 seconds, on the
    155          // 1st of January 2000 UTC

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          UTCTime OSAL_timeSeconds = 0;
   \                     OSAL_timeSeconds:
   \   000000                DS 4
   \   000004                REQUIRE __INIT_XDATA_Z
    157          
    158          /*********************************************************************
    159           * LOCAL FUNCTION PROTOTYPES
    160           */
    161          static uint8 monthLength( uint8 lpyr, uint8 mon );
    162          
    163          static void osalClockUpdate( uint32 elapsedMSec );
    164          
    165          /*********************************************************************
    166           * FUNCTIONS
    167           *********************************************************************/
    168          
    169          /*********************************************************************
    170           * @fn      osalTimeUpdate
    171           *
    172           * @brief   Uses the free running rollover count of the MAC backoff timer;
    173           *          this timer runs freely with a constant 320 usec interval.  The
    174           *          count of 320-usec ticks is converted to msecs and used to update
    175           *          the OSAL clock and Timers by invoking osalClockUpdate() and
    176           *          osalTimerUpdate().  This function is intended to be invoked
    177           *          from the background, not interrupt level.
    178           *
    179           * @param   None.
    180           *
    181           * @return  None.
    182           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    183          void osalTimeUpdate( void ){
   \                     osalTimeUpdate:
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000                REQUIRE ?V11
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
    184           	halIntState_t intState;
    185           	uint32 tmp;
    186           	uint32 ticks320us;
    187           	uint32 elapsedMSec = 0;
   \   000005   75..00       MOV     ?V4,#0x0
   \   000008   75..00       MOV     ?V5,#0x0
   \   00000B   75..00       MOV     ?V6,#0x0
   \   00000E   75..00       MOV     ?V7,#0x0
    188          
    189           	HAL_ENTER_CRITICAL_SECTION(intState);
   \   000011   E5A8         MOV     A,0xa8
   \   000013   FE           MOV     R6,A
   \   000014   C2AF         CLR     0xa8.7
    190           	// Get the free-running count of 320us timer ticks
    191           	tmp = macMcuPrecisionCount();
   \   000016                ; Setup parameters for call to function macMcuPrecisionCount
   \   000016   12....       LCALL   ??macMcuPrecisionCount?relay; Banked call to: macMcuPrecisionCount
   \   000019   8A..         MOV     ?V0,R2
   \   00001B   8B..         MOV     ?V1,R3
   \   00001D   8C..         MOV     ?V2,R4
   \   00001F   8D..         MOV     ?V3,R5
    192            	HAL_EXIT_CRITICAL_SECTION(intState);
   \   000021   EE           MOV     A,R6
   \   000022   A2E7         MOV     C,0xE0 /* A   */.7
   \   000024   A2E7         MOV     C,0xE0 /* A   */.7
   \   000026   92AF         MOV     0xa8.7,C
    193            
    194            	if ( tmp != previousMacTimerTick ) {
   \   000028   90....       MOV     DPTR,#previousMacTimerTick
   \   00002B   78..         MOV     R0,#?V0
   \   00002D   12....       LCALL   ?L_EQ_X
   \   000030   7003         JNZ     $+5
   \   000032   02....       LJMP    ??osalTimeUpdate_0 & 0xFFFF
    195              	// Calculate the elapsed ticks of the free-running timer.
    196              	ticks320us = (tmp - previousMacTimerTick) & 0xffffffffu;
   \   000035   8A..         MOV     ?V8,R2
   \   000037   8B..         MOV     ?V9,R3
   \   000039   8C..         MOV     ?V10,R4
   \   00003B   8D..         MOV     ?V11,R5
   \   00003D   90....       MOV     DPTR,#previousMacTimerTick
   \   000040   78..         MOV     R0,#?V8
   \   000042   12....       LCALL   ?L_SUB_X
    197          
    198              	if (ticks320us >= TIMER_CLOCK_UPDATE ) {
   \   000045   90....       MOV     DPTR,#__Constant_4
   \   000048   78..         MOV     R0,#?V8
   \   00004A   12....       LCALL   ?UL_GE_X
   \   00004D   4003         JC      $+5
   \   00004F   02....       LJMP    ??osalTimeUpdate_0 & 0xFFFF
    199                		// Store the MAC Timer tick count for the next time through this function.
    200                		previousMacTimerTick = tmp;
   \   000052   90....       MOV     DPTR,#previousMacTimerTick
   \   000055   78..         MOV     R0,#?V0
   \   000057   12....       LCALL   ?L_MOV_TO_X
   \   00005A   8010         SJMP    ??osalTimeUpdate_1
    201                
    202                /*
    203                 * remUsTicks can have a maximum value of 24 (Since remusTicks got by mod 
    204                 * of 25). The value of COUNTER_TICK320US is a multiple of 25 and the 
    205                 * quotient of  CONVERT_320US_TO_MS_ELAPSED_REMAINDER() does not exceed 
    206                 * 0xFFFF or 16 bit.
    207                 */
    208                		while(ticks320us >= COUNTER_TICK320US) {
    209                  		ticks320us  -= COUNTER_TICK320US;
   \                     ??osalTimeUpdate_2:
   \   00005C   90....       MOV     DPTR,#__Constant_fffce019
   \   00005F   78..         MOV     R0,#?V8
   \   000061   12....       LCALL   ?L_ADD_X
    210                  		elapsedMSec += COUNTER_ELAPSEDMS;
   \   000064   90....       MOV     DPTR,#__Constant_fff8
   \   000067   78..         MOV     R0,#?V4
   \   000069   12....       LCALL   ?L_ADD_X
    211                		}
   \                     ??osalTimeUpdate_1:
   \   00006C   90....       MOV     DPTR,#__Constant_31fe7
   \   00006F   78..         MOV     R0,#?V8
   \   000071   12....       LCALL   ?UL_GE_X
   \   000074   40E6         JC      ??osalTimeUpdate_2
    212              
    213                		// update converted number with remaining ticks from loop and the accumulated remainder from loop
    214                		tmp = (ticks320us * 8) + remUsTicks;
    215          
    216                		// Convert the 320 us ticks into milliseconds and a remainder
    217                		CONVERT_320US_TO_MS_ELAPSED_REMAINDER( tmp, elapsedMSec, remUsTicks );
   \   000076                ; Setup parameters for call to function osalMcuDivide31By16To16
   \   000076   75..19       MOV     ?V0,#0x19
   \   000079   75..00       MOV     ?V1,#0x0
   \   00007C   78..         MOV     R0,#?V0
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000081   7403         MOV     A,#0x3
   \   000083   78..         MOV     R0,#?V8
   \   000085   12....       LCALL   ?L_SHL
   \   000088   90....       MOV     DPTR,#remUsTicks
   \   00008B   E0           MOVX    A,@DPTR
   \   00008C   F5..         MOV     ?V0,A
   \   00008E   A3           INC     DPTR
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   F5..         MOV     ?V1,A
   \   000092   E4           CLR     A
   \   000093   F5..         MOV     ?V2,A
   \   000095   F5..         MOV     ?V3,A
   \   000097   78..         MOV     R0,#?V8
   \   000099   79..         MOV     R1,#?V0
   \   00009B   12....       LCALL   ?L_ADD
   \   00009E   AA..         MOV     R2,?V8
   \   0000A0   AB..         MOV     R3,?V9
   \   0000A2   AC..         MOV     R4,?V10
   \   0000A4   AD..         MOV     R5,?V11
   \   0000A6   12....       LCALL   osalMcuDivide31By16To16 & 0xFFFF
   \   0000A9   7402         MOV     A,#0x2
   \   0000AB   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000AE   8A..         MOV     ?V8,R2
   \   0000B0   8B..         MOV     ?V9,R3
   \   0000B2   8C..         MOV     ?V10,R4
   \   0000B4   8D..         MOV     ?V11,R5
   \   0000B6   7410         MOV     A,#0x10
   \   0000B8   78..         MOV     R0,#?V8
   \   0000BA   12....       LCALL   ?UL_SHR
   \   0000BD   78..         MOV     R0,#?V4
   \   0000BF   79..         MOV     R1,#?V8
   \   0000C1   12....       LCALL   ?L_ADD
   \   0000C4   90....       MOV     DPTR,#remUsTicks
   \   0000C7   EA           MOV     A,R2
   \   0000C8   F0           MOVX    @DPTR,A
   \   0000C9   A3           INC     DPTR
   \   0000CA   EB           MOV     A,R3
   \   0000CB   F0           MOVX    @DPTR,A
    218                
    219                		// Update OSAL Clock and Timers
    220                		osalClockUpdate( elapsedMSec );
   \   0000CC   A2AF         MOV     C,0xa8.7
   \   0000CE   E4           CLR     A
   \   0000CF   33           RLC     A
   \   0000D0   FE           MOV     R6,A
   \   0000D1   C2AF         CLR     0xa8.7
   \   0000D3   90....       MOV     DPTR,#timeMSec
   \   0000D6   78..         MOV     R0,#?V4
   \   0000D8   12....       LCALL   ?L_ADD_TO_X
   \   0000DB   90....       MOV     DPTR,#__Constant_3e8
   \   0000DE   78..         MOV     R0,#?V0
   \   0000E0   12....       LCALL   ?L_MOV_X
   \   0000E3   90....       MOV     DPTR,#timeMSec
   \   0000E6   78..         MOV     R0,#?V0
   \   0000E8   12....       LCALL   ?UL_GT_X
   \   0000EB   4041         JC      ??osalTimeUpdate_3
   \   0000ED                ; Setup parameters for call to function osalMcuDivide31By16To16
   \   0000ED   75..E8       MOV     ?V0,#-0x18
   \   0000F0   75..03       MOV     ?V1,#0x3
   \   0000F3   78..         MOV     R0,#?V0
   \   0000F5   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000F8   90....       MOV     DPTR,#timeMSec
   \   0000FB   12....       LCALL   ?XLOAD_R2345
   \   0000FE   12....       LCALL   osalMcuDivide31By16To16 & 0xFFFF
   \   000101   7402         MOV     A,#0x2
   \   000103   12....       LCALL   ?DEALLOC_XSTACK8
   \   000106   8A..         MOV     ?V8,R2
   \   000108   8B..         MOV     ?V9,R3
   \   00010A   8A..         MOV     ?V0,R2
   \   00010C   8B..         MOV     ?V1,R3
   \   00010E   8C..         MOV     ?V2,R4
   \   000110   8D..         MOV     ?V3,R5
   \   000112   7410         MOV     A,#0x10
   \   000114   78..         MOV     R0,#?V0
   \   000116   12....       LCALL   ?UL_SHR
   \   000119   90....       MOV     DPTR,#OSAL_timeSeconds
   \   00011C   78..         MOV     R0,#?V0
   \   00011E   12....       LCALL   ?L_ADD_TO_X
   \   000121   A8..         MOV     R0,?V8
   \   000123   A9..         MOV     R1,?V9
   \   000125   E4           CLR     A
   \   000126   FA           MOV     R2,A
   \   000127   FB           MOV     R3,A
   \   000128   90....       MOV     DPTR,#timeMSec
   \   00012B   12....       LCALL   ?XSTORE_R0123
   \                     ??osalTimeUpdate_3:
   \   00012E   EE           MOV     A,R6
   \   00012F   A2E0         MOV     C,0xE0 /* A   */.0
   \   000131   92AF         MOV     0xa8.7,C
    221                		osalTimerUpdate( elapsedMSec );
   \   000133                ; Setup parameters for call to function osalTimerUpdate
   \   000133   AA..         MOV     R2,?V4
   \   000135   AB..         MOV     R3,?V5
   \   000137   AC..         MOV     R4,?V6
   \   000139   AD..         MOV     R5,?V7
   \   00013B   12....       LCALL   ??osalTimerUpdate?relay; Banked call to: osalTimerUpdate
    222              	}
    223            	}
    224          }
   \                     ??osalTimeUpdate_0:
   \   00013E                REQUIRE ?Subroutine0
   \   00013E                REQUIRE _A_IEN0
   \   00013E                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F0C         MOV     R7,#0xc
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    225          
    226          /*********************************************************************
    227           * @fn      osalClockUpdate
    228           *
    229           * @brief   Updates the OSAL Clock time with elapsed milliseconds.
    230           *
    231           * @param   elapsedMSec - elapsed milliseconds
    232           *
    233           * @return  none
    234           */
    235          static void osalClockUpdate( uint32 elapsedMSec )
    236          {
    237            uint32 tmp;
    238            halIntState_t intState;
    239            
    240            HAL_ENTER_CRITICAL_SECTION(intState);
    241            // Add elapsed milliseconds to the saved millisecond portion of time
    242            timeMSec += elapsedMSec;
    243          
    244            // Roll up milliseconds to the number of seconds
    245            if ( timeMSec >= 1000 )
    246            {
    247              tmp = timeMSec;
    248              CONVERT_MS_TO_S_ELAPSED_REMAINDER(tmp, OSAL_timeSeconds, timeMSec);
    249            }
    250            HAL_EXIT_CRITICAL_SECTION(intState);
    251          }
    252          
    253          #ifdef HAL_BOARD_CC2538
    254          /*********************************************************************
    255           * @fn      osalAdjustTimer
    256           *
    257           * @brief   Updates the OSAL Clock and Timer with elapsed milliseconds.
    258           *
    259           * @param   MSec - elapsed milliseconds
    260           *
    261           * @return  none
    262           */
    263          void osalAdjustTimer(uint32 Msec )
    264          {
    265            /* Disable SysTick interrupts */ 
    266            SysTickIntDisable(); 
    267            
    268            osalClockUpdate(Msec);
    269            osalTimerUpdate(Msec);
    270            
    271            /* Enable SysTick interrupts */ 
    272            SysTickIntEnable(); 
    273          }
    274          #endif /* HAL_BOARD_CC2538 */
    275          
    276          /*********************************************************************
    277           * @fn      osal_setClock
    278           *
    279           * @brief   Set the new time.  This will only set the seconds portion
    280           *          of time and doesn't change the factional second counter.
    281           *
    282           * @param   newTime - number of seconds since 0 hrs, 0 minutes,
    283           *                    0 seconds, on the 1st of January 2000 UTC
    284           *
    285           * @return  none
    286           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    287          void osal_setClock( UTCTime newTime )
   \                     osal_setClock:
    288          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0,R2
   \   000007   8B..         MOV     ?V1,R3
   \   000009   8C..         MOV     ?V2,R4
   \   00000B   8D..         MOV     ?V3,R5
    289            HAL_CRITICAL_STATEMENT(OSAL_timeSeconds = newTime);
   \   00000D   E5A8         MOV     A,0xa8
   \   00000F   F9           MOV     R1,A
   \   000010   C2AF         CLR     0xa8.7
   \   000012   90....       MOV     DPTR,#OSAL_timeSeconds
   \   000015   78..         MOV     R0,#?V0
   \   000017   12....       LCALL   ?L_MOV_TO_X
   \   00001A   E9           MOV     A,R1
   \   00001B   A2E7         MOV     C,0xE0 /* A   */.7
   \   00001D   A2E7         MOV     C,0xE0 /* A   */.7
   \   00001F   92AF         MOV     0xa8.7,C
    290          }
   \   000021   7F04         MOV     R7,#0x4
   \   000023   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000026                REQUIRE _A_IEN0
    291          
    292          /*********************************************************************
    293           * @fn      osal_getClock
    294           *
    295           * @brief   Gets the current time.  This will only return the seconds
    296           *          portion of time and doesn't include the factional second
    297           *          counter.
    298           *
    299           * @param   none
    300           *
    301           * @return  number of seconds since 0 hrs, 0 minutes, 0 seconds,
    302           *          on the 1st of January 2000 UTC
    303           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    304          UTCTime osal_getClock( void )
   \                     osal_getClock:
    305          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    306            return ( OSAL_timeSeconds );
   \   000004   90....       MOV     DPTR,#OSAL_timeSeconds
   \   000007   12....       LCALL   ?XLOAD_R2345
   \   00000A   D083         POP     DPH
   \   00000C   D082         POP     DPL
   \   00000E   02....       LJMP    ?BRET
    307          }
    308          
    309          /*********************************************************************
    310           * @fn      osal_ConvertUTCTime
    311           *
    312           * @brief   Converts UTCTime to UTCTimeStruct
    313           *
    314           * @param   tm - pointer to breakdown struct
    315           *
    316           * @param   secTime - number of seconds since 0 hrs, 0 minutes,
    317           *          0 seconds, on the 1st of January 2000 UTC
    318           *
    319           * @return  none
    320           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    321          void osal_ConvertUTCTime( UTCTimeStruct *tm, UTCTime secTime )
   \                     osal_ConvertUTCTime:
    322          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000                REQUIRE ?V11
   \   000000                REQUIRE ?V12
   \   000000                REQUIRE ?V13
   \   000000                REQUIRE ?V14
   \   000000                REQUIRE ?V15
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 2
   \   000005   74FE         MOV     A,#-0x2
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   EA           MOV     A,R2
   \   000011   F0           MOVX    @DPTR,A
   \   000012   A3           INC     DPTR
   \   000013   EB           MOV     A,R3
   \   000014   F0           MOVX    @DPTR,A
   \   000015   741A         MOV     A,#0x1a
   \   000017   12....       LCALL   ?XSTACK_DISP0_8
   \   00001A   78..         MOV     R0,#?V4
   \   00001C   12....       LCALL   ?L_MOV_X
    323            // calculate the time less than a day - hours, minutes, seconds
    324            {
    325              uint32 day = secTime % DAY;
   \   00001F   85....       MOV     ?V0,?V4
   \   000022   85....       MOV     ?V1,?V5
   \   000025   85....       MOV     ?V2,?V6
   \   000028   85....       MOV     ?V3,?V7
   \   00002B   90....       MOV     DPTR,#__Constant_15180
   \   00002E   78..         MOV     R0,#?V8
   \   000030   12....       LCALL   ?L_MOV_X
   \   000033   78..         MOV     R0,#?V0
   \   000035   79..         MOV     R1,#?V8
   \   000037   12....       LCALL   ?UL_DIV_MOD
    326              tm->seconds = day % 60UL;
   \   00003A   85....       MOV     ?V12,?V8
   \   00003D   85....       MOV     ?V13,?V9
   \   000040   85....       MOV     ?V14,?V10
   \   000043   85....       MOV     ?V15,?V11
   \   000046   90....       MOV     DPTR,#__Constant_3c
   \   000049   78..         MOV     R0,#?V0
   \   00004B   12....       LCALL   ?L_MOV_X
   \   00004E   78..         MOV     R0,#?V12
   \   000050   79..         MOV     R1,#?V0
   \   000052   12....       LCALL   ?UL_DIV_MOD
   \   000055   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   000058   E5..         MOV     A,?V0
   \   00005A   F0           MOVX    @DPTR,A
    327              tm->minutes = (day % 3600UL) / 60UL;
   \   00005B   85....       MOV     ?V12,?V8
   \   00005E   85....       MOV     ?V13,?V9
   \   000061   85....       MOV     ?V14,?V10
   \   000064   85....       MOV     ?V15,?V11
   \   000067   90....       MOV     DPTR,#__Constant_e10
   \   00006A   78..         MOV     R0,#?V0
   \   00006C   12....       LCALL   ?L_MOV_X
   \   00006F   78..         MOV     R0,#?V12
   \   000071   79..         MOV     R1,#?V0
   \   000073   12....       LCALL   ?UL_DIV_MOD
   \   000076   90....       MOV     DPTR,#__Constant_3c
   \   000079   78..         MOV     R0,#?V12
   \   00007B   12....       LCALL   ?L_MOV_X
   \   00007E   78..         MOV     R0,#?V0
   \   000080   79..         MOV     R1,#?V12
   \   000082   12....       LCALL   ?UL_DIV_MOD
   \   000085   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   000088   A3           INC     DPTR
   \   000089   E5..         MOV     A,?V0
   \   00008B   F0           MOVX    @DPTR,A
    328              tm->hour = day / 3600UL;
   \   00008C   90....       MOV     DPTR,#__Constant_e10
   \   00008F   78..         MOV     R0,#?V0
   \   000091   12....       LCALL   ?L_MOV_X
   \   000094   78..         MOV     R0,#?V8
   \   000096   79..         MOV     R1,#?V0
   \   000098   12....       LCALL   ?UL_DIV_MOD
   \   00009B   12....       LCALL   ?Subroutine3 & 0xFFFF
    329            }
   \                     ??CrossCallReturnLabel_2:
   \   00009E   E5..         MOV     A,?V8
   \   0000A0   F0           MOVX    @DPTR,A
    330          
    331            // Fill in the calendar - day, month, year
    332            {
    333              uint16 numDays = secTime / DAY;
   \   0000A1   90....       MOV     DPTR,#__Constant_15180
   \   0000A4   78..         MOV     R0,#?V0
   \   0000A6   12....       LCALL   ?L_MOV_X
   \   0000A9   78..         MOV     R0,#?V4
   \   0000AB   79..         MOV     R1,#?V0
   \   0000AD   12....       LCALL   ?UL_DIV_MOD
   \   0000B0   AE..         MOV     R6,?V4
   \   0000B2   AF..         MOV     R7,?V5
    334              tm->year = BEGYEAR;
   \   0000B4   85..82       MOV     DPL,?XSP + 0
   \   0000B7   85..83       MOV     DPH,?XSP + 1
   \   0000BA   E0           MOVX    A,@DPTR
   \   0000BB   2405         ADD     A,#0x5
   \   0000BD   F5..         MOV     ?V0,A
   \   0000BF   A3           INC     DPTR
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   3400         ADDC    A,#0x0
   \   0000C3   F5..         MOV     ?V1,A
   \   0000C5   85..82       MOV     DPL,?V0
   \   0000C8   F583         MOV     DPH,A
   \   0000CA   74D0         MOV     A,#-0x30
   \   0000CC   F0           MOVX    @DPTR,A
   \   0000CD   A3           INC     DPTR
   \   0000CE   7407         MOV     A,#0x7
   \   0000D0   8018         SJMP    ??osal_ConvertUTCTime_0
    335              while ( numDays >= YearLength( tm->year ) )
    336              {
    337                numDays -= YearLength( tm->year );
   \                     ??osal_ConvertUTCTime_1:
   \   0000D2   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCTime_2:
   \   0000D4   C3           CLR     C
   \   0000D5   EE           MOV     A,R6
   \   0000D6   98           SUBB    A,R0
   \   0000D7   FE           MOV     R6,A
   \   0000D8   EF           MOV     A,R7
   \   0000D9   9401         SUBB    A,#0x1
   \   0000DB   FF           MOV     R7,A
    338                tm->year++;
   \   0000DC   85..82       MOV     DPL,?V0
   \   0000DF   85..83       MOV     DPH,?V1
   \   0000E2   E0           MOVX    A,@DPTR
   \   0000E3   2401         ADD     A,#0x1
   \   0000E5   F0           MOVX    @DPTR,A
   \   0000E6   A3           INC     DPTR
   \   0000E7   E0           MOVX    A,@DPTR
   \   0000E8   3400         ADDC    A,#0x0
   \                     ??osal_ConvertUTCTime_0:
   \   0000EA   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   0000ED   12....       LCALL   ?US_DIV_MOD
   \   0000F0   8A..         MOV     ?V2,R2
   \   0000F2   8B..         MOV     ?V3,R3
   \   0000F4   EA           MOV     A,R2
   \   0000F5   45..         ORL     A,?V3
   \   0000F7   6017         JZ      ??osal_ConvertUTCTime_3
   \   0000F9   EC           MOV     A,R4
   \   0000FA   F8           MOV     R0,A
   \   0000FB   ED           MOV     A,R5
   \   0000FC   F9           MOV     R1,A
   \   0000FD   7A64         MOV     R2,#0x64
   \   0000FF   7B00         MOV     R3,#0x0
   \   000101   12....       LCALL   ?US_DIV_MOD
   \   000104   8B..         MOV     ?V5,R3
   \   000106   EA           MOV     A,R2
   \   000107   45..         ORL     A,?V5
   \   000109   6009         JZ      ??osal_ConvertUTCTime_4
   \   00010B   EC           MOV     A,R4
   \   00010C   5403         ANL     A,#0x3
   \   00010E   7004         JNZ     ??osal_ConvertUTCTime_4
   \                     ??osal_ConvertUTCTime_3:
   \   000110   786E         MOV     R0,#0x6e
   \   000112   8002         SJMP    ??osal_ConvertUTCTime_5
   \                     ??osal_ConvertUTCTime_4:
   \   000114   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCTime_5:
   \   000116   EE           MOV     A,R6
   \   000117   98           SUBB    A,R0
   \   000118   EF           MOV     A,R7
   \   000119   9401         SUBB    A,#0x1
   \   00011B   4021         JC      ??osal_ConvertUTCTime_6
   \   00011D   E5..         MOV     A,?V2
   \   00011F   45..         ORL     A,?V3
   \   000121   6017         JZ      ??osal_ConvertUTCTime_7
   \   000123   EC           MOV     A,R4
   \   000124   F8           MOV     R0,A
   \   000125   ED           MOV     A,R5
   \   000126   F9           MOV     R1,A
   \   000127   7A64         MOV     R2,#0x64
   \   000129   7B00         MOV     R3,#0x0
   \   00012B   12....       LCALL   ?US_DIV_MOD
   \   00012E   8B..         MOV     ?V3,R3
   \   000130   EA           MOV     A,R2
   \   000131   45..         ORL     A,?V3
   \   000133   609D         JZ      ??osal_ConvertUTCTime_1
   \   000135   EC           MOV     A,R4
   \   000136   5403         ANL     A,#0x3
   \   000138   7098         JNZ     ??osal_ConvertUTCTime_1
   \                     ??osal_ConvertUTCTime_7:
   \   00013A   786E         MOV     R0,#0x6e
   \   00013C   8096         SJMP    ??osal_ConvertUTCTime_2
    339              }
    340          
    341              tm->month = 0;
   \                     ??osal_ConvertUTCTime_6:
   \   00013E   85..82       MOV     DPL,?XSP + 0
   \   000141   85..83       MOV     DPH,?XSP + 1
   \   000144   E0           MOVX    A,@DPTR
   \   000145   2404         ADD     A,#0x4
   \   000147   F5..         MOV     ?V2,A
   \   000149   A3           INC     DPTR
   \   00014A   E0           MOVX    A,@DPTR
   \   00014B   3400         ADDC    A,#0x0
   \   00014D   F5..         MOV     ?V3,A
   \   00014F   85..82       MOV     DPL,?V2
   \   000152   F583         MOV     DPH,A
   \   000154   E4           CLR     A
   \   000155   801F         SJMP    ??osal_ConvertUTCTime_8
    342              while ( numDays >= monthLength( IsLeapYear( tm->year ), tm->month ) )
    343              {
    344                numDays -= monthLength( IsLeapYear( tm->year ), tm->month );
   \                     ??osal_ConvertUTCTime_9:
   \   000157   7900         MOV     R1,#0x0
   \                     ??osal_ConvertUTCTime_10:
   \   000159                ; Setup parameters for call to function monthLength
   \   000159   85..82       MOV     DPL,?V2
   \   00015C   85..83       MOV     DPH,?V3
   \   00015F   E0           MOVX    A,@DPTR
   \   000160   FA           MOV     R2,A
   \   000161   12....       LCALL   ??monthLength?relay  ; Banked call to: monthLength
   \   000164   E9           MOV     A,R1
   \   000165   F8           MOV     R0,A
   \   000166   C3           CLR     C
   \   000167   EE           MOV     A,R6
   \   000168   98           SUBB    A,R0
   \   000169   FE           MOV     R6,A
   \   00016A   EF           MOV     A,R7
   \   00016B   9400         SUBB    A,#0x0
   \   00016D   FF           MOV     R7,A
    345                tm->month++;
   \   00016E   85..82       MOV     DPL,?V2
   \   000171   85..83       MOV     DPH,?V3
   \   000174   E0           MOVX    A,@DPTR
   \   000175   04           INC     A
   \                     ??osal_ConvertUTCTime_8:
   \   000176   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000179   12....       LCALL   ?US_DIV_MOD
   \   00017C   8B..         MOV     ?V5,R3
   \   00017E   EA           MOV     A,R2
   \   00017F   45..         ORL     A,?V5
   \   000181   6017         JZ      ??osal_ConvertUTCTime_11
   \   000183   EC           MOV     A,R4
   \   000184   F8           MOV     R0,A
   \   000185   ED           MOV     A,R5
   \   000186   F9           MOV     R1,A
   \   000187   7A64         MOV     R2,#0x64
   \   000189   7B00         MOV     R3,#0x0
   \   00018B   12....       LCALL   ?US_DIV_MOD
   \   00018E   8B..         MOV     ?V5,R3
   \   000190   EA           MOV     A,R2
   \   000191   45..         ORL     A,?V5
   \   000193   6009         JZ      ??osal_ConvertUTCTime_12
   \   000195   EC           MOV     A,R4
   \   000196   5403         ANL     A,#0x3
   \   000198   7004         JNZ     ??osal_ConvertUTCTime_12
   \                     ??osal_ConvertUTCTime_11:
   \   00019A   7901         MOV     R1,#0x1
   \   00019C   8002         SJMP    ??osal_ConvertUTCTime_13
   \                     ??osal_ConvertUTCTime_12:
   \   00019E   7900         MOV     R1,#0x0
   \                     ??osal_ConvertUTCTime_13:
   \   0001A0                ; Setup parameters for call to function monthLength
   \   0001A0   85..82       MOV     DPL,?V2
   \   0001A3   85..83       MOV     DPH,?V3
   \   0001A6   E0           MOVX    A,@DPTR
   \   0001A7   FA           MOV     R2,A
   \   0001A8   12....       LCALL   ??monthLength?relay  ; Banked call to: monthLength
   \   0001AB   E9           MOV     A,R1
   \   0001AC   F8           MOV     R0,A
   \   0001AD   C3           CLR     C
   \   0001AE   EE           MOV     A,R6
   \   0001AF   98           SUBB    A,R0
   \   0001B0   EF           MOV     A,R7
   \   0001B1   9400         SUBB    A,#0x0
   \   0001B3   402C         JC      ??osal_ConvertUTCTime_14
   \   0001B5   12....       LCALL   ??Subroutine6_0 & 0xFFFF
    346              }
   \                     ??CrossCallReturnLabel_10:
   \   0001B8   12....       LCALL   ?US_DIV_MOD
   \   0001BB   8B..         MOV     ?V5,R3
   \   0001BD   EA           MOV     A,R2
   \   0001BE   45..         ORL     A,?V5
   \   0001C0   601A         JZ      ??osal_ConvertUTCTime_15
   \   0001C2   EC           MOV     A,R4
   \   0001C3   F8           MOV     R0,A
   \   0001C4   ED           MOV     A,R5
   \   0001C5   F9           MOV     R1,A
   \   0001C6   7A64         MOV     R2,#0x64
   \   0001C8   7B00         MOV     R3,#0x0
   \   0001CA   12....       LCALL   ?US_DIV_MOD
   \   0001CD   8B..         MOV     ?V5,R3
   \   0001CF   EA           MOV     A,R2
   \   0001D0   45..         ORL     A,?V5
   \   0001D2   6083         JZ      ??osal_ConvertUTCTime_9
   \   0001D4   EC           MOV     A,R4
   \   0001D5   5403         ANL     A,#0x3
   \   0001D7   6003         JZ      $+5
   \   0001D9   02....       LJMP    ??osal_ConvertUTCTime_9 & 0xFFFF
   \                     ??osal_ConvertUTCTime_15:
   \   0001DC   7901         MOV     R1,#0x1
   \   0001DE   02....       LJMP    ??osal_ConvertUTCTime_10 & 0xFFFF
    347          
    348              tm->day = numDays;
   \                     ??osal_ConvertUTCTime_14:
   \   0001E1   12....       LCALL   ?Subroutine3 & 0xFFFF
    349            }
   \                     ??CrossCallReturnLabel_3:
   \   0001E4   A3           INC     DPTR
   \   0001E5   EE           MOV     A,R6
   \   0001E6   F0           MOVX    @DPTR,A
    350          }
   \   0001E7   7402         MOV     A,#0x2
   \   0001E9   12....       LCALL   ?DEALLOC_XSTACK8
   \   0001EC   7F10         MOV     R7,#0x10
   \   0001EE   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F8           MOV     R0,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   F583         MOV     DPH,A
   \   00000C   8882         MOV     DPL,R0
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_6:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                REQUIRE ??Subroutine6_0
   \   000001                ; // Fall through to label ??Subroutine6_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine6_0:
   \   000000   85..82       MOV     DPL,?V0
   \   000003   85..83       MOV     DPH,?V1
   \   000006   E0           MOVX    A,@DPTR
   \   000007   FC           MOV     R4,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   FD           MOV     R5,A
   \   00000B   EC           MOV     A,R4
   \   00000C   F8           MOV     R0,A
   \   00000D   ED           MOV     A,R5
   \   00000E   F9           MOV     R1,A
   \   00000F   7A90         MOV     R2,#-0x70
   \   000011   7B01         MOV     R3,#0x1
   \   000013   22           RET
    351          
    352          /*********************************************************************
    353           * @fn      monthLength
    354           *
    355           * @param   lpyr - 1 for leap year, 0 if not
    356           *
    357           * @param   mon - 0 - 11 (jan - dec)
    358           *
    359           * @return  number of days in specified month
    360           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    361          static uint8 monthLength( uint8 lpyr, uint8 mon )
   \                     monthLength:
    362          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   F8           MOV     R0,A
    363            uint8 days = 31;
   \   000002   791F         MOV     R1,#0x1f
    364          
    365          	if ( mon == 1 ) // feb
   \   000004   7401         MOV     A,#0x1
   \   000006   6A           XRL     A,R2
   \   000007   7006         JNZ     ??monthLength_0
    366            {
    367          		days = ( 28 + lpyr );
   \   000009   741C         MOV     A,#0x1c
   \   00000B   28           ADD     A,R0
   \   00000C   F9           MOV     R1,A
   \   00000D   800D         SJMP    ??monthLength_1
    368            }
    369            else
    370            {
    371              if ( mon > 6 ) // aug-dec
   \                     ??monthLength_0:
   \   00000F   EA           MOV     A,R2
   \   000010   C3           CLR     C
   \   000011   9407         SUBB    A,#0x7
   \   000013   4001         JC      ??monthLength_2
    372              {
    373                mon--;
   \   000015   1A           DEC     R2
    374              }
    375          
    376              if ( mon & 1 )
   \                     ??monthLength_2:
   \   000016   EA           MOV     A,R2
   \   000017   A2E0         MOV     C,0xE0 /* A   */.0
   \   000019   5001         JNC     ??monthLength_1
    377              {
    378                days = 30;
   \   00001B   19           DEC     R1
    379              }
    380            }
    381          
    382          	return ( days );
   \                     ??monthLength_1:
   \   00001C   02....       LJMP    ?BRET
    383          }
    384          
    385          /*********************************************************************
    386           * @fn      osal_ConvertUTCSecs
    387           *
    388           * @brief   Converts a UTCTimeStruct to UTCTime
    389           *
    390           * @param   tm - pointer to provided struct
    391           *
    392           * @return  number of seconds since 00:00:00 on 01/01/2000 (UTC)
    393           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    394          UTCTime osal_ConvertUTCSecs( UTCTimeStruct *tm )
   \                     osal_ConvertUTCSecs:
    395          {
   \   000000                REQUIRE ?V0
   \   000000                REQUIRE ?V1
   \   000000                REQUIRE ?V2
   \   000000                REQUIRE ?V3
   \   000000                REQUIRE ?V4
   \   000000                REQUIRE ?V5
   \   000000                REQUIRE ?V6
   \   000000                REQUIRE ?V7
   \   000000                REQUIRE ?V8
   \   000000                REQUIRE ?V9
   \   000000                REQUIRE ?V10
   \   000000                REQUIRE ?V11
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    396            uint32 seconds;
    397          
    398            /* Seconds for the partial day */
    399            seconds = (((tm->hour * 60UL) + tm->minutes) * 60UL) + tm->seconds;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F5..         MOV     ?V4,A
   \   000012   E4           CLR     A
   \   000013   F5..         MOV     ?V5,A
   \   000015   F5..         MOV     ?V6,A
   \   000017   F5..         MOV     ?V7,A
   \   000019   90....       MOV     DPTR,#__Constant_3c
   \   00001C   78..         MOV     R0,#?V0
   \   00001E   12....       LCALL   ?L_MOV_X
   \   000021   78..         MOV     R0,#?V4
   \   000023   79..         MOV     R1,#?V0
   \   000025   12....       LCALL   ?L_MUL
   \   000028   8E82         MOV     DPL,R6
   \   00002A   8F83         MOV     DPH,R7
   \   00002C   A3           INC     DPTR
   \   00002D   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000030   12....       LCALL   ?L_ADD
   \   000033   90....       MOV     DPTR,#__Constant_3c
   \   000036   78..         MOV     R0,#?V0
   \   000038   12....       LCALL   ?L_MOV_X
   \   00003B   78..         MOV     R0,#?V4
   \   00003D   79..         MOV     R1,#?V0
   \   00003F   12....       LCALL   ?L_MUL
   \   000042   8E82         MOV     DPL,R6
   \   000044   8F83         MOV     DPH,R7
   \   000046   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   000049   12....       LCALL   ?L_ADD
    400          
    401            /* Account for previous complete days */
    402            {
    403              /* Start with complete days in current month */
    404              uint16 days = tm->day;
   \   00004C   A3           INC     DPTR
   \   00004D   A3           INC     DPTR
   \   00004E   A3           INC     DPTR
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   F5..         MOV     ?V0,A
    405          
    406              /* Next, complete months in current year */
    407              {
    408                int8 month = tm->month;
   \   000052   8E82         MOV     DPL,R6
   \   000054   8F83         MOV     DPH,R7
   \   000056   A3           INC     DPTR
   \   000057   A3           INC     DPTR
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   E0           MOVX    A,@DPTR
   \   00005B   F5..         MOV     ?V8,A
   \   00005D   8011         SJMP    ??osal_ConvertUTCSecs_0
    409                while ( --month >= 0 )
    410                {
    411                  days += monthLength( IsLeapYear( tm->year ), month );
   \                     ??osal_ConvertUTCSecs_1:
   \   00005F   7900         MOV     R1,#0x0
   \                     ??osal_ConvertUTCSecs_2:
   \   000061                ; Setup parameters for call to function monthLength
   \   000061   AA..         MOV     R2,?V8
   \   000063   12....       LCALL   ??monthLength?relay  ; Banked call to: monthLength
   \   000066   E5..         MOV     A,?V0
   \   000068   29           ADD     A,R1
   \   000069   F5..         MOV     ?V0,A
   \   00006B   E4           CLR     A
   \   00006C   35..         ADDC    A,?V1
   \   00006E   F5..         MOV     ?V1,A
   \                     ??osal_ConvertUTCSecs_0:
   \   000070   15..         DEC     ?V8
   \   000072   8E82         MOV     DPL,R6
   \   000074   8F83         MOV     DPH,R7
   \   000076   A3           INC     DPTR
   \   000077   A3           INC     DPTR
   \   000078   A3           INC     DPTR
   \   000079   A3           INC     DPTR
   \   00007A   A3           INC     DPTR
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F5..         MOV     ?V2,A
   \   00007E   A3           INC     DPTR
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   F5..         MOV     ?V3,A
   \   000082   E5..         MOV     A,?V8
   \   000084   C3           CLR     C
   \   000085   9400         SUBB    A,#0x0
   \   000087   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000089   65D0         XRL     A,PSW
   \   00008B   33           RLC     A
   \   00008C   402E         JC      ??osal_ConvertUTCSecs_3
   \   00008E   A8..         MOV     R0,?V2
   \   000090   A9..         MOV     R1,?V3
   \   000092   7A90         MOV     R2,#-0x70
   \   000094   7B01         MOV     R3,#0x1
   \   000096   12....       LCALL   ?US_DIV_MOD
   \   000099   8B..         MOV     ?V11,R3
   \   00009B   EA           MOV     A,R2
   \   00009C   45..         ORL     A,?V11
   \   00009E   6018         JZ      ??osal_ConvertUTCSecs_4
   \   0000A0   A8..         MOV     R0,?V2
   \   0000A2   A9..         MOV     R1,?V3
   \   0000A4   7A64         MOV     R2,#0x64
   \   0000A6   7B00         MOV     R3,#0x0
   \   0000A8   12....       LCALL   ?US_DIV_MOD
   \   0000AB   8B..         MOV     ?V11,R3
   \   0000AD   EA           MOV     A,R2
   \   0000AE   45..         ORL     A,?V11
   \   0000B0   60AD         JZ      ??osal_ConvertUTCSecs_1
   \   0000B2   E5..         MOV     A,?V2
   \   0000B4   5403         ANL     A,#0x3
   \   0000B6   70A7         JNZ     ??osal_ConvertUTCSecs_1
   \                     ??osal_ConvertUTCSecs_4:
   \   0000B8   7901         MOV     R1,#0x1
   \   0000BA   80A5         SJMP    ??osal_ConvertUTCSecs_2
    412                }
    413              }
    414          
    415              /* Next, complete years before current year */
    416              {
    417                uint16 year = tm->year;
   \                     ??osal_ConvertUTCSecs_3:
   \   0000BC   AC..         MOV     R4,?V2
   \   0000BE   AD..         MOV     R5,?V3
   \   0000C0   800D         SJMP    ??osal_ConvertUTCSecs_5
    418                while ( --year >= BEGYEAR )
    419                {
    420                  days += YearLength( year );
   \                     ??osal_ConvertUTCSecs_6:
   \   0000C2   786D         MOV     R0,#0x6d
   \                     ??osal_ConvertUTCSecs_7:
   \   0000C4   E5..         MOV     A,?V0
   \   0000C6   28           ADD     A,R0
   \   0000C7   F5..         MOV     ?V0,A
   \   0000C9   E5..         MOV     A,?V1
   \   0000CB   3401         ADDC    A,#0x1
   \   0000CD   F5..         MOV     ?V1,A
   \                     ??osal_ConvertUTCSecs_5:
   \   0000CF   EC           MOV     A,R4
   \   0000D0   24FF         ADD     A,#-0x1
   \   0000D2   1C           DEC     R4
   \   0000D3   ED           MOV     A,R5
   \   0000D4   34FF         ADDC    A,#-0x1
   \   0000D6   FD           MOV     R5,A
   \   0000D7   C3           CLR     C
   \   0000D8   EC           MOV     A,R4
   \   0000D9   94D0         SUBB    A,#-0x30
   \   0000DB   ED           MOV     A,R5
   \   0000DC   9407         SUBB    A,#0x7
   \   0000DE   402D         JC      ??osal_ConvertUTCSecs_8
   \   0000E0   EC           MOV     A,R4
   \   0000E1   F8           MOV     R0,A
   \   0000E2   ED           MOV     A,R5
   \   0000E3   F9           MOV     R1,A
   \   0000E4   7A90         MOV     R2,#-0x70
   \   0000E6   7B01         MOV     R3,#0x1
   \   0000E8   12....       LCALL   ?US_DIV_MOD
   \   0000EB   8B..         MOV     ?V3,R3
   \   0000ED   EA           MOV     A,R2
   \   0000EE   45..         ORL     A,?V3
   \   0000F0   6017         JZ      ??osal_ConvertUTCSecs_9
   \   0000F2   EC           MOV     A,R4
   \   0000F3   F8           MOV     R0,A
   \   0000F4   ED           MOV     A,R5
   \   0000F5   F9           MOV     R1,A
   \   0000F6   7A64         MOV     R2,#0x64
   \   0000F8   7B00         MOV     R3,#0x0
   \   0000FA   12....       LCALL   ?US_DIV_MOD
   \   0000FD   8B..         MOV     ?V3,R3
   \   0000FF   EA           MOV     A,R2
   \   000100   45..         ORL     A,?V3
   \   000102   60BE         JZ      ??osal_ConvertUTCSecs_6
   \   000104   EC           MOV     A,R4
   \   000105   5403         ANL     A,#0x3
   \   000107   70B9         JNZ     ??osal_ConvertUTCSecs_6
   \                     ??osal_ConvertUTCSecs_9:
   \   000109   786E         MOV     R0,#0x6e
   \   00010B   80B7         SJMP    ??osal_ConvertUTCSecs_7
    421                }
    422              }
    423          
    424              /* Add total seconds before partial day */
    425              seconds += (days * DAY);
    426            }
    427          
    428            return ( seconds );
   \                     ??osal_ConvertUTCSecs_8:
   \   00010D   E4           CLR     A
   \   00010E   F5..         MOV     ?V2,A
   \   000110   F5..         MOV     ?V3,A
   \   000112   90....       MOV     DPTR,#__Constant_15180
   \   000115   78..         MOV     R0,#?V8
   \   000117   12....       LCALL   ?L_MOV_X
   \   00011A   78..         MOV     R0,#?V0
   \   00011C   79..         MOV     R1,#?V8
   \   00011E   12....       LCALL   ?L_MUL
   \   000121   78..         MOV     R0,#?V4
   \   000123   79..         MOV     R1,#?V0
   \   000125   12....       LCALL   ?L_ADD
   \   000128   AA..         MOV     R2,?V4
   \   00012A   AB..         MOV     R3,?V5
   \   00012C   AC..         MOV     R4,?V6
   \   00012E   AD..         MOV     R5,?V7
   \   000130   02....       LJMP    ?Subroutine0 & 0xFFFF
    429          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F5..         MOV     ?V0,A
   \   000003   E4           CLR     A
   \   000004   F5..         MOV     ?V1,A
   \   000006   F5..         MOV     ?V2,A
   \   000008   F5..         MOV     ?V3,A
   \   00000A   78..         MOV     R0,#?V4
   \   00000C   79..         MOV     R1,#?V0
   \   00000E   22           RET

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_4:
   \   000000   04000000     DD 4

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_fffce019:
   \   000000   19E0FCFF     DD 4294762521

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_fff8:
   \   000000   F8FF0000     DD 65528

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_31fe7:
   \   000000   E71F0300     DD 204775

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3e8:
   \   000000   E8030000     DD 1000

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_15180:
   \   000000   80510100     DD 86400

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3c:
   \   000000   3C000000     DD 60

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_e10:
   \   000000   100E0000     DD 3600

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osalTimeUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osalTimeUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_setClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_setClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_getClock?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_getClock

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_ConvertUTCTime?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_ConvertUTCTime

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??monthLength?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    monthLength

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??osal_ConvertUTCSecs?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    osal_ConvertUTCSecs

   Maximum stack usage in bytes:

   ISTACK XSTACK Function
   ------ ------ --------
      0     26   monthLength
      0     22   osalTimeUpdate
        0     20   -> macMcuPrecisionCount
        0     22   -> osalMcuDivide31By16To16
        0     20   -> osalTimerUpdate
      0     20   osal_ConvertUTCSecs
        0     20   -> monthLength
      1     30   osal_ConvertUTCTime
        0     26   -> monthLength
      2      0   osal_getClock
      0     12   osal_setClock


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
      20  ??Subroutine6_0
       6  ??monthLength?relay
       6  ??osalTimeUpdate?relay
       6  ??osal_ConvertUTCSecs?relay
       6  ??osal_ConvertUTCTime?relay
       6  ??osal_getClock?relay
       6  ??osal_setClock?relay
       5  ?Subroutine0
       1  ?Subroutine1
      15  ?Subroutine2
       6  ?Subroutine3
       4  ?Subroutine4
      15  ?Subroutine5
       4  OSAL_timeSeconds
       1  _A_IEN0
       4  __Constant_15180
       4  __Constant_31fe7
       4  __Constant_3c
       4  __Constant_3e8
       4  __Constant_4
       4  __Constant_e10
       4  __Constant_fff8
       4  __Constant_fffce019
      31  monthLength
     318  osalTimeUpdate
     307  osal_ConvertUTCSecs
     497  osal_ConvertUTCTime
      17  osal_getClock
      38  osal_setClock
       4  previousMacTimerTick
       2  remUsTicks
       4  timeMSec

 
 1 274 bytes in segment BANKED_CODE
    36 bytes in segment BANK_RELAYS
     1 byte  in segment SFR_AN
    32 bytes in segment XDATA_ROM_C
    14 bytes in segment XDATA_Z
 
 1 310 bytes of CODE  memory
     0 bytes of CONST memory (+ 32 bytes shared)
     0 bytes of DATA  memory (+  1 byte  shared)
    14 bytes of XDATA memory

Errors: none
Warnings: none
